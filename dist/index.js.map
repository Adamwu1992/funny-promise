{"version":3,"file":"index.js","sources":["../src/utils.js","../src/asap.js","../src/core.js","../src/promise/resolve.js","../src/promise/reject.js","../src/promise/race.js","../index.js"],"sourcesContent":["export function needResolver() {\n  throw new TypeError('You must pass a resolver function as the first argument to the promise constructor.');\n}\n\nexport function needNew() {\n  throw new TypeError('Failed to construct \\'Promise\\': Please use the \\'new\\' operator, this object constructor cannot be called as a function.');\n}\n\nexport function selfFulfilled() {\n  throw new TypeError('You cannot resolve a promise with itself.')\n}\n\nexport function returnOwn() {\n  return new TypeError('A promises callback cannot return that same promise.')\n}\n\nexport function needArray() {\n  throw new TypeError('You must pass an array as argument.')\n}\n\nexport function noop() {}\n\nexport function isFunction(x) {\n  return typeof x === 'function';\n}\n\nexport function isArray(x) {\n  return Array.isArray(x);\n}\n\nlet id = 0;\nexport function nextId() {\n  return id++;\n}\n\nexport function isObjectOrFunction(x) {\n  const t = typeof x;\n  return x !== null && (t === 'object' || t === 'function');\n}","export default function(callback, args) {\n  setTimeout(callback, 1, args);\n}","import {\n  selfFulfilled,\n  isFunction,\n  returnOwn,\n  isObjectOrFunction\n} from './utils';\nimport asap from './asap';\n\nexport const PENDING = void 0;\nexport const FULFILLED = 1;\nexport const REJECTED = 2;\n\nconst TRY_CATCH_ERROR = { error: null }\nfunction tryCatch(callback, value) {\n  try {\n    return callback(value);\n  } catch(e) {\n    TRY_CATCH_ERROR.error = e;\n    return TRY_CATCH_ERROR;\n  }\n}\n\nfunction tryThen(then, value, onFulfillment, onRejection) {\n  try {\n    then.call(value, onFulfillment, onRejection);\n  } catch(e) {\n    return e;\n  }\n}\n\nfunction getThen(thenable) {\n  try {\n    return thenable.then;\n  } catch (e) {\n    TRY_CATCH_ERROR.error = e;\n    return TRY_CATCH_ERROR;\n  }\n}\n\nexport function resolve(promise, value) {\n  if (promise === value) {\n    reject(promise, selfFulfilled());\n  } else if (isObjectOrFunction(value)) {\n    handleMaybeThenable(promise, value, getThen(value));\n  } else {\n    fulfill(promise, value);\n  }\n}\n\nexport function handleMaybeThenable(promise, thenable, then) {\n  // 判断是否promise\n  if (thenable.constructor === promise.constructor) {\n    handlePromise(promise, thenable);\n  } else if (isFunction(then)) {\n    handleForeignThenable(promise, thenable, then);\n  } else if (then === TRY_CATCH_ERROR) {\n    reject(promise, TRY_CATCH_ERROR.error);\n    TRY_CATCH_ERROR.error = null;\n  } else {\n    fulfill(promise, thenable);\n  }\n}\n\nexport function handlePromise(promise, thenable) {\n  if (thenable._state === FULFILLED) {\n    fulfill(promise, thenable._result);\n  } else if (thenable._state === REJECTED) {\n    reject(promise, thenable._result);\n  } else {\n    subscribe(\n      thenable,\n      undefined,\n      value => resolve(promise, value),\n      reason => reject(promise, reason)\n    );\n  }\n}\n\nexport function handleForeignThenable(promise, thenable, then) {\n  asap(promise => {\n    let sealed = false;\n    const error = tryThen(\n      then,\n      thenable,\n      value => {\n        if (sealed) return;\n        sealed = true;\n        if (thenable !== value) {\n          resolve(promise, value);\n        } else {\n          fulfill(promise, value);\n        }\n      },\n      reason => {\n        if (sealed) return;\n        sealed = true;\n        reject(promise, reason);\n      }\n    );\n\n    if (!sealed && error) {\n      sealed = true;\n      reject(promise, error);\n    }\n\n  }, promise);\n}\n\nexport function fulfill(promise, value) {\n  if (promise._state !== PENDING) return;\n  promise._state = FULFILLED\n  promise._result = value;\n\n  if (promise._subscribers.length !== 0) {\n    asap(publish, promise);\n  }\n}\n\nexport function reject(promise, reason) {\n  if (promise._state !== PENDING) return;\n  promise._state = REJECTED\n  promise._result = reason;\n\n  if (promise._subscribers.length !== 0) {\n    asap(publish, promise);\n  }\n}\n\nexport function publish(promise) {\n  const subscribers = promise._subscribers;\n\n  if (promise._state === PENDING || subscribers.length === 0) return;\n\n  for(let i = 0; i < subscribers.length; i += 3) {\n    const child = subscribers[i];\n    const callback = subscribers[i + promise._state];\n\n    if (child) {\n      invokeCallback(child, promise._state, callback, promise._result);\n    } else {\n      callback(promise._result);\n    }\n  }\n\n  subscribers.length = 0;\n}\n\n/**\n * \n * @param {*} promise: child promise\n * @param {*} state: parent promise's state\n * @param {*} callback: for child promise\n * @param {*} result: parent promse's result\n */\nexport function invokeCallback(promise, state, callback, result) {\n  const hasCallback = isFunction(callback);\n  let value;\n  let error;\n  let succeed;\n  let failed;\n\n  if (hasCallback) {\n    value = tryCatch(callback, result);\n    if (value === TRY_CATCH_ERROR) {\n      failed = true;\n      error = TRY_CATCH_ERROR.error;\n      TRY_CATCH_ERROR.error = null;\n    } else {\n      succeed = true;\n    }\n    if (value === promise) {\n      reject(promise, returnOwn())\n      return;\n    }\n  } else {\n    value = result;\n    succeed = true;\n  }\n\n  if (promise._state !== PENDING) return;\n  // 将promise迁移到对应的状态\n  if (hasCallback) {\n    if (succeed) {\n      resolve(promise, value);\n    } else if (failed) {\n      reject(promise, error);\n    }\n  } else {\n    if (state === FULFILLED) {\n      fulfill(promise, value);\n    } else if (state === REJECTED) {\n      reject(promise, value);\n    }\n  }\n}\n\nexport function subscribe(parent, child, onFulfillment, onRejection) {\n  const subscribers = parent._subscribers;\n  const length = subscribers.length;\n\n  subscribers[length] = child;\n  subscribers[length + 1] = onFulfillment;\n  subscribers[length + 2] = onRejection;\n\n  if (length === 0 && parent._state !== PENDING) {\n    asap(publish, parent);\n  }\n}","import { resolve as _resolve } from '../core';\nimport { noop } from '../utils';\n\nexport default function(value) {\n  const Constructor = this;\n  if (value && value.constructor === Constructor) {\n    return value;\n  }\n  \n  const promise = new Constructor(noop);\n  _resolve(promise, value);\n  return promise;\n}","import { reject as _reject } from '../core';\nimport { noop } from '../utils';\n\nexport default function(reason) {\n  const Constructor = this;\n  const promise = new Constructor(noop);\n  _reject(promise, reason);\n  return promise;\n}","import { isArray, needArray } from '../utils';\n\nexport default function(entries) {\n  const Constructor = this;\n  if (isArray) {\n    return new Constructor((resolve, reject) => {\n      for(let i = 0; i < entries.length; i++) {\n        const e = entries[i];\n        Constructor.resolve(e).then(resolve, reject);\n      }\n    });\n  }\n  return new Constructor((_, reject) => {\n    reject(needArray());\n  });\n}","\nimport {\n  resolve,\n  reject,\n  PENDING,\n  FULFILLED,\n  invokeCallback,\n  subscribe\n} from './src/core';\nimport {\n  needResolver,\n  needNew,\n  isFunction,\n  noop,\n  nextId\n} from './src/utils';\nimport asap from './src/asap';\nimport originalResolve from './src/promise/resolve';\nimport originReject from './src/promise/reject';\nimport race from './src/promise/race';\n\nfunction checkResolver(resolver) {\n  return isFunction(resolver) || needResolver();\n}\n\nfunction checkNew(x) {\n  return x instanceof Promise || needNew()\n}\n\nclass Promise {\n  constructor(resolver) {\n    this._ID = nextId();\n    this._result = undefined;\n    this._state = undefined;\n    this._subscribers = [];\n\n    if (checkResolver(resolver) && checkNew(this)) {\n      // 执行resolver\n      try {\n        resolver(\n          value => resolve(this, value),\n          reason => reject(this, reason)\n        )\n      } catch(e) {\n        reject(this, e);\n      }\n    }\n  }\n\n  then(onFulfillment, onRejection) {\n    const parent = this;\n    const child = new this.constructor(noop);\n\n    if (parent._state !== PENDING) {\n      const callback = parent._state === FULFILLED ? onFulfillment : onRejection;\n      asap(() => {\n        invokeCallback(child, parent._state, callback, parent._result);\n      })\n    } else {\n      subscribe(parent, child, onFulfillment, onRejection);\n    }\n\n    return child;\n  }\n\n  catch(onRejection) {\n    return this.then(null, onRejection);\n  }\n\n  finally(callback) {\n    return this.then(callback, callback)\n  }\n}\n\nPromise.resolve = originalResolve;\nPromise.reject = originReject;\nPromise.race = race;\n\nexport default Promise;"],"names":["needResolver","TypeError","needNew","selfFulfilled","returnOwn","needArray","noop","isFunction","x","isArray","Array","id","nextId","isObjectOrFunction","t","callback","args","setTimeout","PENDING","FULFILLED","REJECTED","TRY_CATCH_ERROR","error","tryCatch","value","e","tryThen","then","onFulfillment","onRejection","call","getThen","thenable","resolve","promise","reject","handleMaybeThenable","fulfill","constructor","handlePromise","handleForeignThenable","_state","_result","subscribe","undefined","reason","asap","sealed","_subscribers","length","publish","subscribers","i","child","invokeCallback","state","result","hasCallback","succeed","failed","parent","Constructor","_resolve","_reject","entries","_","checkResolver","resolver","checkNew","Promise","_ID","originalResolve","originReject","race"],"mappings":"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"}